<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random US Coordinates Generator</title>
    <script src="https://www.bing.com/api/maps/mapcontrol?callback=initMap" async defer></script>
    <script>
        let map;

        function initMap() {
            map = new Microsoft.Maps.Map(document.getElementById("map"), {
                credentials: "Am5crN3GYeGWoUNc1aGT9_sYmOrs24KX1KfvNx-keoFL-zA5rt7XluescD_tjKmU"
            });
        }

        function getRandomCoordinate() {
            const usBounds = [
                { minLat: 25.0, maxLat: 49.0, minLon: -124.784, maxLon: -67, weight: 0.95 }, // Contiguous US
                { minLat: 19.501, maxLat: 28.402, minLon: -161.755, maxLon: -154.806, weight: 0.02 }, // Hawaii
                { minLat: 54.0, maxLat: 71.538, minLon: -169.0, maxLon: -130.0, weight: 0.03 } // Alaska
            ];
            
            let rand = Math.random();
            let region;
            if (rand < 0.7) {
                region = usBounds[0];
            } else if (rand < 0.9) {
                region = usBounds[1];
            } else {
                region = usBounds[2];
            }
            
            return {
                lat: Math.random() * (region.maxLat - region.minLat) + region.minLat,
                lon: Math.random() * (region.maxLon - region.minLon) + region.minLon
            };
        }

        function checkIfValidUSLocation(lat, lon) {
            const url = `https://dev.virtualearth.net/REST/v1/Locations/${lat},${lon}?key=Am5crN3GYeGWoUNc1aGT9_sYmOrs24KX1KfvNx-keoFL-zA5rt7XluescD_tjKmU`;
            return fetch(url).then(response => response.json()).then(data => {
                if (data.resourceSets.length > 0 && data.resourceSets[0].resources.length > 0) {
                    const resource = data.resourceSets[0].resources[0];
                    const entityType = resource.entityType;
                    const country = resource.address.countryRegion;
                    return entityType !== "WaterBody" && country === "United States";
                }
                return false;
            });
        }

        async function generateRandomUSLocation() {
            let validLocation = false;
            let coord;
            while (!validLocation) {
                coord = getRandomCoordinate();
                validLocation = await checkIfValidUSLocation(coord.lat, coord.lon);
            }
            document.getElementById("output").innerText = `Latitude: ${coord.lat}, Longitude: ${coord.lon}`;
            const location = new Microsoft.Maps.Location(coord.lat, coord.lon);
            map.setView({ center: location, zoom: 6 });
            const pin = new Microsoft.Maps.Pushpin(location, {});
            map.entities.clear();
            map.entities.push(pin);
        }
    </script>
</head>
<body>
    <h1>Random US Coordinates Generator (Excluding Water)</h1>
    <button onclick="generateRandomUSLocation()">Generate Random Location</button>
    <p id="output">Click the button to generate coordinates.</p>
    <div id="map" style="width: 100%; height: 500px;"></div>
</body>
</html>
